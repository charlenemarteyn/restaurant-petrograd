<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Petrograd restaurant</title>
        <link rel="stylesheet" href="css/css.css">
    </head>

    <body>
        <main>
            <div class="modal hide">
                <div class="modal-content">
                    <img class="modal-image" src="data-image" alt="data-caption">
                    <h2 class="modal-name">Data name</h2>
                    <div class="bordurelong"></div>
                    <p class="modal-description">data-longdescription</p>
                    <h4 class="modal-price">data-price</h4>
                </div>
            </div>
            <header class="top">
                <h1 class="title">Petrograd restaurant</h1>
            </header>
            <nav>
                <a class="borderline" href="">Home</a>
                <a href="#">Menu</a>
                <a class="borderline" href="">Contact</a>
            </nav>

            <section class="starter">
                <h1>Starter</h1>
            </section>

            <section class="maindish">
                <h1>Main</h1>
            </section>

            <section class="dessert">
                <h1>Dessert</h1>
            </section>

            <section class="side">
                <h1>Side dishes</h1>
            </section>

            <section class="drinks">
                <h1>Drinks</h1>
            </section>

            <template class="product">
                <article class="list-product">
                    <img class="banner" src="http://www.freeiconspng.com/uploads/sold-out-png-4.png">
                    <div class="container"><img class="product-small-img" src="data-small-img" alt="data-caption">
                        <div class="middle"><svg class="logo1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 64 80" style="enable-background:new 0 0 64 64;" xml:space="preserve"><path d="M47,19c-3.8,0-6.5-1.5-9.5-3.3C33.7,13.5,29.4,11,22,11c-8.5,0-22,5.7-22,21c0,14.6,11.7,23,32,23  c21.2,0,32-6.4,32-19C64,26.5,56.5,19,47,19z M32,53C20.8,53,2,50.3,2,32c0-13.8,12.3-19,20-19c6.8,0,10.7,2.2,14.5,4.4  C39.6,19.3,42.6,21,47,21c8.4,0,15,6.6,15,15C62,47.4,52.2,53,32,53z M22,18c-4.8,0-9.4,2.2-12.2,5.9c-0.2,0.3-1,0.5-1.4,0.2  s-0.5-1-0.2-1.4C11.4,18.5,16.6,16,22,16c0.6,0,1,0.4,1,1S22.6,18,22,18z M7.9,27.4C7.3,28.9,7,30.4,7,32c0,0.6-0.4,1-1,1  s-1-0.4-1-1c0-1.8,0.3-3.6,1-5.4c0.2-0.5,0.8-0.8,1.3-0.6C7.8,26.3,8.1,26.8,7.9,27.4z M17.8,25.3c0.9,1,1.2,2.1,1.2,3.7  s-0.4,2.7-1.3,3.7c-0.4,0.4-1,0.4-1.4,0.1c-0.4-0.4-0.4-1-0.1-1.4c0.5-0.5,0.7-1.1,0.7-2.3c0-1.1,0-1.8-0.7-2.4  c-0.4-0.3-0.3-1.1,0.1-1.5S17.4,24.9,17.8,25.3z M30.8,21.3c0.9,1,1.2,2.1,1.2,3.7s-0.4,2.7-1.3,3.7c-0.4,0.4-1,0.4-1.4,0.1  c-0.4-0.4-0.4-1-0.1-1.4c0.5-0.5,0.7-1.1,0.7-2.3c0-1.1,0-1.8-0.7-2.4c-0.4-0.3-0.3-1.1,0.1-1.5S30.4,20.9,30.8,21.3z M43.8,25.3  c0.9,1,1.2,2.1,1.2,3.7s-0.4,2.7-1.3,3.7c-0.4,0.4-1,0.4-1.4,0.1c-0.4-0.4-0.4-1-0.1-1.4c0.5-0.5,0.7-1.1,0.7-2.3  c0-1.1,0-1.8-0.7-2.4c-0.4-0.3-0.3-1.1,0.1-1.5S43.4,24.9,43.8,25.3z M23.8,37.3c0.9,1,1.2,2.1,1.2,3.7s-0.4,2.7-1.3,3.7  c-0.4,0.4-1,0.4-1.4,0.1c-0.4-0.4-0.4-1-0.1-1.4c0.5-0.5,0.7-1.1,0.7-2.3c0-1.1,0-1.8-0.7-2.4c-0.4-0.3-0.3-1.1,0.1-1.5  S23.4,36.9,23.8,37.3z M35.8,40.3c0.9,1,1.2,2.1,1.2,3.7s-0.4,2.7-1.3,3.7c-0.4,0.4-1,0.4-1.4,0.1c-0.4-0.4-0.4-1-0.1-1.4  c0.5-0.5,0.7-1.1,0.7-2.3c0-1.1,0-1.8-0.7-2.4c-0.4-0.3-0.3-1.1,0.1-1.5S35.4,39.9,35.8,40.3z M50.8,38.3c0.9,1,1.2,2.1,1.2,3.7  c0,1.6-0.4,2.7-1.3,3.7c-0.4,0.4-1,0.4-1.4,0.1c-0.4-0.4-0.4-1-0.1-1.4c0.5-0.5,0.7-1.1,0.7-2.3c0-1.1,0-1.8-0.7-2.4  c-0.4-0.3-0.3-1.1,0.1-1.5S50.4,37.9,50.8,38.3z"/></svg>
                        </div>
                    </div>
                    <h2 class="name">data-name</h2>
                    <div class="bordure"></div>
                    <p class="short-description"></p>
                    <button>details</button>
                    <p class="alcohol"></p>
                    <h3 class="price"><span>data-price</span> kr.</h3>
                </article>
            </template>
        </main>

        <script>
            let productlist_link = "http://kea-alt-del.dk/t5/api/productlist";
            let product_link = "http://kea-alt-del.dk/t5/api/product?id=";
            let image_path = "http://kea-alt-del.dk/t5/site/imgs/small/";
            let section = document.querySelector('section');
            let template = document.querySelector('.product').content;

            function getData(link){
                fetch(link).then(function(response){
                    return response.json();
                }).then(function(json){
                    return show(json);
                });
            }

            let modal = document.querySelector('.modal');
            modal.addEventListener('click', function(){
                modal.classList.add('hide');
            });


            function show(json){
                console.log(json);
                json.forEach(function(product){
                    console.log(product.name + " " + product.price + " DKK");
                    let clone = template.cloneNode(true);
                    clone.querySelector('.name').textContent=product.name;
                    clone.querySelector('.price').textContent=product.price + " DKK";
                    clone.querySelector('.product-small-img').src=image_path+product.image+"-sm.jpg";
                    clone.querySelector('.short-description').textContent=product.shortdescription;

                    let detailsButton = clone.querySelector('button');

                    detailsButton.addEventListener('click', function(){
                        let link = product_link + product.id;
                        fetch(link).then(function(response){
                            return response.json();
                        }).then(function(productJson){
                            showDetails(productJson);
                        })
                    })


                    if (product.alcohol){
                        console.log('Contains alcohol');

                    } else{
                        //we should hide it
                        clone.querySelector('.alcohol').classList.add('hidden');
                    }

                    if (product.soldout){
                        clone.querySelector('.list-product').classList.add('soldout');
                    }

                    if (product.discount){
                        let newPrice =product.price-product.price * product.discount/100;
                        //console.log(product.price, product.discount, newPrice);

                        //cross out the old price
                        clone.querySelector('.price').classList.add("discount");
                        //display a new price
                        let newPriceElem = document.createElement('h4');
                        newPrice

                    }

                    let section;
                    if(product.category=='starter'){
                        section = document.querySelector('.starter');
                    }
                    else if (product.category=="main"){
                        section = document.querySelector('.maindish');
                    }
                    else if (product.category=="dessert"){
                        section = document.querySelector('.dessert');
                    }
                    else if (product.category=="sideorders"){
                        section = document.querySelector('.side');
                    }
                    else if (product.category=="drinks"){
                        section = document.querySelector('.drinks');
                    }


                    section.appendChild(clone);

                });

            }

            function showDetails(data){
                console.log(data);
                modal.querySelector(".modal-name").textContent = data.name;
                modal.querySelector(".modal-image").src = image_path + data.image + "-sm.jpg";
                if (data.longdescription){
                    modal.querySelector(".modal-description").textContent = data.longdescription;
                } else{
                    modal.querySelector(".modal-description").textContent = data.shortdescription;
                }

                let price = modal.querySelector(".modal-price");
                if(data.discount){
                    let newPrice = Math.floor(data.price-(data.price*data.discount/100));
                    price.textContent = "Now: " + newPrice + ",-";
                }else{
                    price.textContent = "Price: " + data.price + ",-";
                }
                modal.classList.remove('hide');
            }

            getData(productlist_link);

        </script>
    </body>
</html>

